<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Cupones</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<img src="logo.png" width="120">
<h2>Panel Cupones</h2>

<div id="stats">Cargando estadÃ­sticas...</div>

<input id="tel" placeholder="TelÃ©fono cliente">
<button onclick="crear()">Generar QR</button>

<div id="qr"></div>

<br><br>
<a href="/exportar">Exportar reporte</a>

<script>
function cargarStats(){
  fetch("/stats")
    .then(r => r.json())
    .then(d => {
      document.getElementById("stats").innerHTML = `
        <b>ğŸ“Š EstadÃ­sticas</b><br>
        ğŸŸ Creados hoy: ${d.hoy}<br>
        âœ… Canjeados hoy: ${d.usadosHoy}<br>
        ğŸ“¦ Total histÃ³rico: ${d.total}
      `;
    });
}

function crear(){
  fetch("/crear",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ telefono: tel.value })
  })
  .then(r => r.json())
  .then(c => {
    if(!c.qr){
      qr.innerHTML = "<p style='color:red'>âŒ No se generÃ³ el QR</p>";
      return;
    }
    qr.innerHTML = `<img src="${c.qr}" width="220">`;
    tel.value = "";
    cargarStats();
  });
}

cargarStats();
</script>

</body>
</html>


