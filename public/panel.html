<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Crear Cup√≥n</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  height:100vh;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:Arial, sans-serif;
  color:white;
}

.card{
  width:100%;
  max-width:420px;
  background:#1e1e1e;
  padding:30px 20px;
  border-radius:18px;
  text-align:center;
}

h1{
  font-size:32px;
  margin-bottom:20px;
}

input{
  width:100%;
  padding:18px;
  font-size:22px;
  border-radius:12px;
  border:none;
  margin-bottom:20px;
  text-align:center;
}

button{
  width:100%;
  height:85px;
  font-size:26px;
  font-weight:bold;
  background:#2196f3;
  color:white;
  border:none;
  border-radius:16px;
}

img{
  margin-top:20px;
  width:260px;
}

a{
  display:block;
  margin-top:20px;
  font-size:22px;
  color:#4caf50;
  font-weight:bold;
  text-decoration:none;
}

.stats{
  margin-top:30px;
  padding:18px;
  background:#111;
  border-radius:12px;
  font-size:20px;
  text-align:left;
}

.stats p{
  margin:8px 0;
}

.ok{
  color:#4caf50;
  font-weight:bold;
}
</style>
</head>

<body>
<div class="card">
  <h1>üéü Crear cup√≥n</h1>

  <input id="tel" placeholder="WhatsApp (ej: 912345678)">

  <button onclick="crear()">GENERAR CUP√ìN</button>

  <div id="out"></div>

  <div class="stats" id="stats">
    Cargando estad√≠sticas...
  </div>
</div>

<script>
async function crear(){
  const res = await fetch("/crear",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ telefono: tel.value })
  });

  if(!res.ok){
    out.innerHTML = "<p style='color:red;font-size:20px'>‚ùå Error al crear cup√≥n</p>";
    return;
  }

  const c = await res.json();

  if(!c.qr){
    out.innerHTML = "<p style='color:red;font-size:20px'>‚ùå No se recibi√≥ el QR</p>";
    console.log(c);
    return;
  }

  out.innerHTML = `
    <p style="font-size:22px;margin-top:20px;">QR generado</p>
    <img src="${c.qr}">
    <a target="_blank"
       href="https://wa.me/56${c.telefono}?text=Tu%20cup√≥n:%20${location.origin}/cupon/${c.id}">
       üì≤ Enviar por WhatsApp
    </a>
  `;

  tel.value = "";
  cargarStats();
}

async function cargarStats(){
  const r = await fetch("/stats");
  const s = await r.json();
  document.getElementById("stats").innerHTML = `
    <p><b>üìä Resumen de hoy</b></p>
    <p>üéü Creados hoy: <span class="ok">${s.hoy}</span></p>
    <p>‚úÖ Canjeados hoy: <span class="ok">${s.usadosHoy}</span></p>
    <p>üì¶ Total hist√≥rico: <b>${s.total}</b></p>
  `;
}

cargarStats();
</script>
</body>
</html>
