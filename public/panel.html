<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Crear Cup√≥n</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  margin:0;
  height:100vh;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:Arial, sans-serif;
  color:white;
}
.card{
  width:100%;
  max-width:420px;
  background:#1e1e1e;
  padding:30px 20px;
  border-radius:18px;
  text-align:center;
}
h1{ font-size:32px; margin-bottom:20px; }
input{
  width:100%;
  padding:18px;
  font-size:22px;
  border-radius:12px;
  border:none;
  margin-bottom:15px;
  text-align:center;
}
button{
  width:100%;
  height:85px;
  font-size:26px;
  font-weight:bold;
  background:#2196f3;
  color:white;
  border:none;
  border-radius:16px;
}
img{ margin-top:20px; width:260px; }
a{
  display:block;
  margin-top:20px;
  font-size:22px;
  color:#4caf50;
  font-weight:bold;
  text-decoration:none;
}
.stats{
  margin-top:30px;
  padding:18px;
  background:#111;
  border-radius:12px;
  font-size:20px;
  text-align:left;
}
.ok{ color:#4caf50; font-weight:bold; }
.error{ color:#ff5252; font-weight:bold; }
</style>
</head>
<body>

<div class="card">
  <h1>üéü Crear cup√≥n</h1>

  <input id="rut" placeholder="RUT cliente (sin validar)">
  <input id="tel" placeholder="WhatsApp (opcional)">

  <button onclick="crear()">GENERAR CUP√ìN</button>

  <div id="out"></div>

  <div class="stats" id="stats">Cargando estad√≠sticas...</div>
</div>

<script>
async function crear(){
  const res = await fetch("/crear",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      rut: rut.value || "-",
      telefono: tel.value || "-"
    })
  });

  const c = await res.json();

  if(!res.ok){
    out.innerHTML = `<p class="error">‚ùå ${c.error}</p>`;
    return;
  }

  out.innerHTML = `
    <p style="font-size:22px;">QR generado</p>
    <img src="${c.qr}">
    ${c.telefono !== "-" ? `
    <a target="_blank"
      href="https://wa.me/56${c.telefono}?text=Tu%20cup√≥n:%20${location.origin}/cupon/${c.id}">
      üì≤ Enviar por WhatsApp
    </a>` : ""}
  `;

  rut.value = "";
  tel.value = "";
  cargarStats();
}

async function cargarStats(){
  const r = await fetch("/stats");
  const s = await r.json();
  stats.innerHTML = `
    <p><b>üìä Hoy</b></p>
    <p>üéü Creados: <span class="ok">${s.hoy}</span></p>
    <p>‚úÖ Canjeados: <span class="ok">${s.usadosHoy}</span></p>
    <p>üì¶ Total: <b>${s.total}</b></p>
  `;
}
cargarStats();
</script>

</body>
</html>



