<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Panel de Cupones</title>
</head>
<body>

<h2>Crear cup贸n</h2>

<input id="telefono" placeholder="Ej: 56912345678">
<button onclick="crearCupon()">Crear cup贸n</button>

<hr>

<div id="resultado"></div>

<script>
async function crearCupon() {
  const telefono = document.getElementById("telefono").value;

  if (!telefono) {
    alert("Ingresa un n煤mero");
    return;
  }

  const res = await fetch("/crear", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ telefono })
  });

  const data = await res.json();

  if (data.error) {
    alert(data.error);
    return;
  }

  const linkCupon = `${location.origin}/cupon/${data.id}`;
  const mensaje = encodeURIComponent(
    `Hola \nAqu铆 tienes tu cup贸n v谩lido por hoy:\n${linkCupon}`
  );

  const whatsappURL = `https://wa.me/${telefono}?text=${mensaje}`;

  document.getElementById("resultado").innerHTML = `
    <h3>Cup贸n generado</h3>
    <img src="${data.qr}" width="200"><br><br>

    <a href="${whatsappURL}" target="_blank">
       Enviar por WhatsApp
    </a>

    <p><b>Tel茅fono:</b> ${telefono}</p>
  `;
}
</script>

</body>
</html>
